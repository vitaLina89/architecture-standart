### <a name="_b7urdng99y53"></a>**Название задачи:** Открытие депозитов онлайн — архитектура MVP
### <a name="_hjk0fkfyohdk"></a>**Автор:** Вита
### <a name="_uanumrh8zrui"></a>**Дата:** 12.11.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|1|Новый клиент, Публичный сайт|Просмотр депозитов и условий|1. Клиент открывает раздел депозитов на сайте.<br>2. Сайт запрашивает список продуктов и ставок из каталога депозитов.<br>3. Клиент видит доступные продукты, ставки и ключевые условия.|
|2|Новый клиент, Публичный сайт, Система кол-центра|Заявка на депозит c сайта|1. Клиент вводит контактные данные и желаемые параметры депозита.<br>2. Сайт валидирует данные, отправляет заявку в сервис оркестрации депозитов.<br>3. Сервис публикует заявку в очередь и передает в кол-центр для обзвона.<br>4. Клиент получает подтверждение о принятии заявки.|
|3|Существующий клиент, Интернет-банк|Просмотр депозитов в интернет-банке|1. Клиент авторизуется в интернет-банке и открывает раздел «Депозиты».<br>2. Модуль IB запрашивает каталог депозитов и персональные ставки.<br>3. Клиент видит перечень доступных депозитов с персонализацией.|
|4|Существующий клиент, Интернет-банк, СМС-шлюз|Оформление заявки на депозит в IB|1. Клиент выбирает продукт, сумму, счет списания.<br>2. IB выполняет проверку лимитов и резервирования средств через сервис оркестрации.<br>3. Клиент подтверждает операцию по СМС-коду.<br>4. Сервис оркестрации ставит заявку в очередь на обработку АБС, IB отображает статус.|
|5|Сервис оркестрации депозитов, АБС, Менеджер бэк-офиса|Обработка и открытие депозита|1. Интеграционный воркер считывает заявку из очереди и создает запись в АБС.<br>2. Менеджер бэк-офиса в АБС проверяет заявку, согласует ставку.<br>3. После подтверждения АБС обновляет статус и публикует событие «депозит открыт».<br>4. Система отправляет СМС клиенту и обновляет статус в каналах.|
|6|Система отчетности, Команда продуктового направления|Мониторинг и аналитика|1. Сервис оркестрации и IB формируют события (логирование, метрики).<br>2. Данные отправляются в централизованную систему логирования и BI.<br>3. Команда анализирует конверсию и SLA обработки заявок.|
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно значимые требования.

|**№**|**Требование**|
| :-: | :- |
|N1|Доступность каналов и сервисов 99,9%, переключение на резервный ЦОД для интернет-банка и сервисов оркестрации.|
|N2|Максимальное время отклика UI-операций 500 мс (95-й перцентиль), выдача каталога депозитов ≤ 1 с за счет кэширования.|
|N3|Асинхронное взаимодействие с АБС через очередь (Kafka), повторные попытки при временных сбоях, буферизация нагрузки.|
|N4|Кэширование ставок и каталога депозитов с актуализацией не реже чем раз в 5 минут.|
|N5|Шифрование трафика (TLS), СМС-подтверждение критических операций, централизованное логирование и трассировка.|
|N6|Использование стандартизированных технологий банка (.NET, MS SQL, Oracle, Kafka), развертывание через существующий CI/CD.|
|N7|Адаптивный UI, соответствие дизайн-системе, доступность для пользователей старшего возраста.|
|N8|Готовность к горизонтальному масштабированию каналов и сервисов, health-checks для мониторинга.|
### <a name="_qmphm5d6rvi3"></a>**Решение**
Приведите диаграммы контекста и контейнеров в модели C4. Опишите там основные компоненты и интеграции всех элементов решения. 

Также опишите, какой логикой вы руководствовались в ходе принятия решений и выбора технологий. Не забывайте, что необходимо учесть все функциональные и нефункциональные требования.

**Диаграммы**

- C4 Context: `Task3/context-deposit-mvp.md`
- C4 Container (каналы и АБС): `Task3/container-deposit-mvp.md`

**Описание архитектуры**

- **Каналы взаимодействия.** Существующий публичный сайт (PHP, Nginx) и интернет-банк (ASP.NET MVC 4.5, MS SQL) получают функциональные расширения: UI блок «Депозиты», компонент каталога, модуль заявки с СМС-подтверждением. Для минимального риска внедрение выполняет команда цифровых каналов, не изменяя фундаментальную архитектуру монолита, но выделяя слой интеграционных адаптеров внутри.
- **Сервис оркестрации депозитов.** Новый автономный .NET 6 WebAPI/worker-сервис в Kubernetes/Windows cluster обрабатывает запросы каналов, управляет бизнес-правилами, кэширует ставки (Redis), хранит состояние заявок (MS SQL) и публикует события в Kafka. Это изолирует каналы от ограничений АБС, обеспечивает SLA и масштабирование.
- **Интеграция с АБС.** Отдельный worker внутри сервиса оркестрации взаимодействует с АБС через защищенный Integration Layer (Oracle DB шлюз/PL/SQL API). Обработка заявок выполняется асинхронно: worker забирает события из Kafka, создает/обновляет заявки в АБС. Бэк-офисные сотрудники продолжают использовать существующий Delphi-клиент; требуется расширение workflow для утверждения ставки и открытия договора.
- **Каталог депозитов.** Единый источник истины переносится в АБС (Oracle). Периодические задачи синхронизируют данные с кэшем Redis, каналы получают каталог через API оркестрации. Персонализация ставок выполняется на основе правил, реализованных в сервисе оркестрации с использованием данных клиента из АБС.
- **Уведомления.** После успешного открытия депозита или изменения статуса сервис оркестрации отправляет события в Kafka; Notifications Adapter вызывает SMS-шлюз по существующему REST/SOAP API. Дополнительно формируются события для BI/логирования (ELK/Prometheus).
- **Мониторинг и управление.** Все сервисы поставляют health-checks, централизованное логирование (ELK), трассировку запросов (Correlation ID), метрики SLA. Асинхронная обработка позволяет выдержать пиковую нагрузку в 50 заявок/минуту без деградации АБС.

**Команды и зоны ответственности**

- Команда цифровых каналов (Web/IB): UI/UX, интеграционные адаптеры, доработки ASP.NET, взаимодействие с оркестрацией.
- Команда интеграционной платформы: разработка и поддержка сервиса оркестрации, Kafka, Redis, API Gateway.
- Команда АБС: расширение функционала обработки заявок, хранение ставок, согласование ставок и бэк-офисный workflow.
- Команда инфраструктуры/DevOps: CI/CD, контейнеризация сервисов оркестрации, настройка мониторинга и отказоустойчивости.
- Команда безопасности и соответствия: TLS, управление ключами, регламенты доступа, аудит.
- Команда кол-центра: адаптация процессов обработки входящих заявок от сайта.

**Соответствие требованиям**

- Производительность: кэш Redis и асинхронный обмен снижают нагрузку на АБС, обеспечивая SLA по времени отклика.
- Надежность: Kafka и повторные попытки интеграций, репликация сервисов в двух ЦОД.
- Поддерживаемость: выбран стек .NET/Kafka/Oracle, разделение ответственности, централизованное логирование.
- Безопасность: TLS, MFA (СМС), аудит событий.
### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Опишите здесь наиболее важные альтернативные решения.

1. **Прямое подключение интернет-банка к API АБС.** Отказались, чтобы не перегружать АБС и не усложнять монолит IB, нарушая ограничение +R3. Не обеспечивает буферизацию и SLA.
2. **Расширение функционала кол-центра как основного канала.** Рассматривали для снижения объема разработки, но не покрывает требование по самообслуживанию в IB и не масштабируется под целевой рост заявок.
3. **Построение нового микросервиса каталога и расчета ставок в Java.** Отклонено для MVP: увеличивает количество технологий и команд, усложняет эксплуатацию. В перспективе возможен выделенный сервис, но пока логика остается в оркестрации.

**Недостатки, ограничения, риски**

Подробно опишите здесь недостатки, ограничения и риски выбранного решения.

1. **Зависимость от АБС.** Несмотря на асинхронность, время обработки заявки зависит от ручных действий бэк-офиса. Требуется четкий SLA и мониторинг очередей.
2. **Сложность интеграции.** Внедрение Kafka и сервисов оркестрации требует согласования с эксплуатацией и доработки мониторинга. Повышенный порог входа для поддержки.
3. **Технический долг интернет-банка.** Из-за монолита ASP.NET MVC расширение функционала может усложнить кодовую базу и потребовать оптимизации в будущем (переход на микросервисы).
4. **Отправка СМС через существующий шлюз.** При отсутствии ресурсов подрядчика возможны задержки в доработке API; нужен план резервирования.
5. **Управление кэшем ставок.** Ошибки в актуализации могут привести к некорректным персональным предложениям; необходимы процедуры проверки и fallback к данным АБС.
